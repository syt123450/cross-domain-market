<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width = device-width, initial-scale =1.0, maximum-scale = 1.0, user-scalable = no">
    <title>Commodity</title>

    <link rel='icon' href='../img/common/browserLogo.ico' type=‘image/x-ico’>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/commodity.css">
    <script src="../js/common.js"></script>
    <script src="../js/commodity.js"></script>
    <script src="../js/pagination.js"></script>
</head>
<body>

<header>
    <div class="container">
        <img src="../img/common/top_banner.png" alt="webLogo">
    </div>
</header>

<nav>
    <ul class="container">
        <li><a href="../index.html">Home</a></li>
        <li class="nowPage">
            <a>Store</a>
            <ul>
                <!--<li><a href="store.html">SHOP LI-NING</a></li>-->
            </ul>
        </li>
        <li><a href="#contact">Contact</a></li>
        <li>
            <a href="login.html">Log In</a>
            <ul>
                <li>Log Out</li>
            </ul>
        </li>
        <li><a><img id="shoppingCart" src="../img/common/pageIcon/shopping_cart.png"></a></li>
    </ul>
</nav>

<main class="container">
    <div>
        <img src="">
        <div>
            <!--<p>John Deere Men's Waxed Cotton Camo Mesh</p>-->
            <div id="commodityAverageRate">
                <img src="../img/products/star_1.png">
                <img src="../img/products/star_1.png">
                <img src="../img/products/star_1.png">
                <img src="../img/products/star_1.png">
                <img src="../img/products/star_1.png">
            </div>
            <!--<div>-->
            <!--<p>$ 18.28</p>-->
            <!--<p>Only 5 left in stock</p>-->
            <!--</div>-->
            <img src="../img/common/pageIcon/add_to_cart1.png">
        </div>
        <div></div>
    </div>
    <div>
        <header>
            <ul>
                <li id="description" class="activeTitle">DESCRIPTION</li>
                <li id="comment" class="inactiveTitle">COMMENT</li>
                <li id="rate" class="inactiveTitle">RATE</li>
            </ul>
        </header>
        <section id="descriptionContent">
            <!--<p>Size: One Size</p>-->
        </section>
        <section id="commentContent">
            <!--<div class="commentItem">-->
            <!--<p>By Matt on July 3, 2015</p>-->
            <!--<p>-->
            <!--I try to write a lot of reviews but I don't know if I've ever written one about a hat. Well, this-->
            <!--hat is awesome. A great subdued style and well constructed. It seems like ball caps are either tall,-->
            <!--ugly trucker hats best suited for old men and hipsters, or they are unstructured dishrags that look-->
            <!--sloppy.In my opinion this hat is the perfect in-between: structured to look sharp but not tall like-->
            <!--a trucker hat. I was so happy with it I bought a second to keep on hand when/if I wear this one out.-->
            <!--No joke.-->
            <!--</p>-->
            <!--</div>-->
            <div id="paginationArea">
                <ul id="pagination" class="pagination">
                    <li><a>&laquo;</a></li>
                    <li class="active"><a>1</a></li>
                    <li><a>2</a></li>
                    <li><a>...</a></li>
                    <li><a>&raquo;</a></li>
                </ul>
            </div>

            <div id="textarea">
                <textarea placeholder="Add your precious comment here"></textarea>
            </div>
            <div id="commentButton" class="submitButton">Add Comment</div>
            <div id="operationArea">
                <div id="submitComment">Submit</div>
                <div id="cancelComment">Cancel</div>
            </div>
        </section>
        <section id="rateContent" class="submitButton">
            <p>Average rate:</p>
            <img src="../img/products/star_1.png">
            <img src="../img/products/star_1.png">
            <img src="../img/products/star_1.png">
            <img src="../img/products/star_1.png">
            <img src="../img/products/star_1.png">
            <p>Add rate:</p>
            <div>
                <img class="rateStar" src="../img/products/star_empty.png">
                <img class="rateStar" src="../img/products/star_empty.png">
                <img class="rateStar" src="../img/products/star_empty.png">
                <img class="rateStar" src="../img/products/star_empty.png">
                <img class="rateStar" src="../img/products/star_empty.png">
            </div>
            <div id="rateButton" class="submitButton">Submit</div>
        </section>
    </div>
</main>

<footer>
    <div id="contact" class="container">
        <header>Contact Us</header>
        <section>
            <div>Contact us</div>
            <div>Terms & Policy</div>
            <div>Partners</div>
            <div>FAQ</div>
            <div>Our story</div>
        </section>
    </div>

    <div id="copyright">copyright © 2017 Icon brands, inc. All rights reserved</div>

</footer>

<div id="curtain"></div>
<div id="oops">
    <header>OOPS</header>
    <section>
        <p>Please sign in</p>
        <p>So you can add comment or rate</p>
        <div>
            <div id="moveToSignIn">Sign In</div>
            <div id="cancelOperation">Cancel</div>
        </div>
    </section>
</div>

<script>

    $(function () {

        $.ajax({
            url: '../initialize/commodity',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            async: true,
            data: JSON.stringify({
                "storeID": getUrlParameter("storeID"),
                "commodityID": getUrlParameter("commodityID")
            }),
            dataType: 'json',
            success: function (data) {
                console.log(data);
                renderLoadPage(data);
                bindEvent();
            }
        });

        $(".rateStar").hover(
            function () {
                if ($(this).parent().attr("data-rate") == null) {
                    var starNumber = $("#rateContent .rateStar").index(this);
                    for (var i = 0; i <= starNumber; i++) {
                        $($("#rateContent .rateStar")[i]).attr("src", "../img/products/star_1.png");
                    }
                }
            },
            function () {
                if ($(this).parent().attr("data-rate") == null) {
                    for (var i = 0; i < 5; i++) {
                        $($("#rateContent .rateStar")[i]).attr("src", "../img/products/star_empty.png");
                    }
                }
            }
        );

        $(".rateStar").click(function() {
            var starNumber = $("#rateContent .rateStar").index(this);
            $(this).parent().attr("data-rate", starNumber);
        });
    });

    function bindEvent() {
        bindNav();
        bindInfoHeader();
        bindCommentArea();
        bindRateArea();
        bindAlertArea();
    }

    function bindCommentArea() {
        $("#commentButton").click(function () {

            showAddItem();


//            $("#curtain").fadeIn(300);
//            $("#oops").fadeIn(300);
//            $("body").css("overflow", "hidden");
        });

        $("#submitComment").click(function () {
            submitComment();
        });

        $("#cancelComment").click(function () {
            hideAddItem();
        });

    }

    function bindRateArea() {
        $("#rateButton").click(function () {
            $("#curtain").fadeIn(300);
            $("#oops").fadeIn(300);
            $("body").css("overflow", "hidden");
        });
    }

    function bindInfoHeader() {
        $("#description").click(function () {
            setaAllTitleInactive();
            hideAllContent();
            $(this).attr("class", "activeTitle");
            $("#descriptionContent").show();
        });

        $("#comment").click(function () {
            setaAllTitleInactive();
            hideAllContent();
            $(this).attr("class", "activeTitle");
            $("#commentContent").show();
        });

        $("#rate").click(function () {
            setaAllTitleInactive();
            hideAllContent();
            $(this).attr("class", "activeTitle");
            $("#rateContent").show();
        });
    }

    function bindAlertArea() {
        $("#curtain").click(function () {
            $("#curtain").hide();
            $("#oops").hide();
            $("body").css("overflow", "scroll");
        });

        $("#moveToSignIn").click(function () {
            location.href = "login.html";
        });

        $("#cancelOperation").click(function () {
            $("#curtain").hide();
            $("#oops").hide();
            $("body").css("overflow", "scroll");
        });
    }

    function submitComment() {

        var userID = getCookieValue("userID");
        var storeID = getUrlParameter("storeID");
        var commodityID = getUrlParameter("commodityID");
        var comment = $("textarea").val();

        var postBody = {
            "userID": userID,
            "storeID": storeID,
            "commodityID": commodityID,
            "commentContent": comment
        };

        $.ajax({
            url: '../commodity/addComment',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            async: true,
            data: JSON.stringify(postBody),
            dataType: 'json',
            success: function (data) {
                console.log(data);
                hideAddItem();
                renderComment(data.commentData);
                renderPagination(data.commentNumber, 1);
            }
        });
    }

    function submitRate() {

    }

    function hideAddItem() {
        $("textarea").val("");
        $("#textarea").hide();
        $("#operationArea").hide();
        $("#commentButton").show();
    }

    function showAddItem() {
        $("#textarea").show();
        $("#operationArea").show();
        $("#commentButton").hide();
    }


</script>

</body>
</html>